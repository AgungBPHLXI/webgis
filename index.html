<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>WebGIS PBPH & Kawasan Hutan</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>

<style>
body { margin:0; }
#map { height:100vh; }

.filter-box{
    position:absolute;
    top:10px;
    left:50px;
    background:white;
    padding:10px;
    border-radius:6px;
    box-shadow:0 2px 6px rgba(0,0,0,0.3);
    z-index:1000;
}

.legend{
    background:white;
    padding:10px;
    border-radius:6px;
    box-shadow:0 2px 6px rgba(0,0,0,0.3);
    line-height:18px;
}
.legend span{
    display:inline-block;
    width:18px;
    height:12px;
    margin-right:6px;
}
</style>
</head>
<body>

<div class="filter-box">
    <b>Filter Kawasan Hutan</b><br>
    <select id="filterF2025">
        <option value="ALL">Semua</option>
        <option value="HL">HL</option>
        <option value="HP">HP</option>
        <option value="HPT">HPT</option>
        <option value="HPK">HPK</option>
    </select>
</div>

<div id="map"></div>

<script>

// ==================== MAP ====================
var map = L.map('map', {
    zoomControl:false
}).setView([-3.3,115],7);

L.control.zoom({ position:'topright' }).addTo(map);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution:'Â© OpenStreetMap'
}).addTo(map);


// ==================== LOAD DATA ====================
var pbphLayer;
var kawasanLayer;
var kabupatenData;

// load kabupaten (tidak ditampilkan)
fetch('batas_kabupaten.geojson')
.then(res=>res.json())
.then(data=>{
    kabupatenData = data;
});

// ==================== STYLE FUNCTIONS ====================

function stylePBPH(){
    return {
        color:"#ff6600",
        weight:1.5,
        fillColor:"#ffa64d",
        fillOpacity:0.6
    }
}

function styleKawasan(feature){
    let f = feature.properties.F2025;
    let color = "#cccccc";

    if(f==="HL") color="#2e7d32";
    if(f==="HP") color="#66bb6a";
    if(f==="HPT") color="#9ccc65";
    if(f==="HPK") color="#d4e157";

    return {
        color:"#333",
        weight:0.8,
        fillColor:color,
        fillOpacity:0.6
    }
}

// ==================== LOAD PBPH ====================
fetch('pbph.geojson')
.then(res=>res.json())
.then(data=>{
    pbphLayer = L.geoJSON(data,{
        style:stylePBPH,
        onEachFeature:function(feature,layer){
            var p = feature.properties;

            layer.bindPopup(`
                <b>${p.NAMOBJ || '-'}</b><br>
                Status: ${p.STAT_IZIN || '-'}<br>
                Luas: ${p.LUAS ? Number(p.LUAS).toLocaleString() : '-'} Ha
            `);
        }
    }).addTo(map);
});


// ==================== LOAD KAWASAN HUTAN ====================
fetch('Kawasanhutan.geojson')
.then(res=>res.json())
.then(data=>{

    kawasanLayer = L.geoJSON(data,{
        style:styleKawasan,
        onEachFeature:function(feature,layer){

            layer.on('click',function(e){

                var point = turf.point([e.latlng.lng, e.latlng.lat]);
                var namaKab = "Tidak diketahui";

                kabupatenData.features.forEach(function(kab){
                    if(turf.booleanPointInPolygon(point,kab)){
                        namaKab = kab.properties.NAMOBJ || kab.properties.KABUPATEN || "-";
                    }
                });

                var p = feature.properties;

                layer.bindPopup(`
                    <b>Kawasan Hutan</b><br>
                    Kabupaten: ${namaKab}<br>
                    Luas: ${p.LUAS ? Number(p.LUAS).toLocaleString() : '-'} Ha
                `).openPopup();

            });
        }
    }).addTo(map);

});


// ==================== FILTER ====================
document.getElementById("filterF2025").addEventListener("change",function(){

    var value = this.value;

    kawasanLayer.eachLayer(function(layer){

        if(value==="ALL"){
            layer.setStyle({opacity:1, fillOpacity:0.6});
        }
        else if(layer.feature.properties.F2025===value){
            layer.setStyle({opacity:1, fillOpacity:0.6});
        }
        else{
            layer.setStyle({opacity:0, fillOpacity:0});
        }

    });

});


// ==================== LEGEND ====================
var legend = L.control({position:'bottomright'});

legend.onAdd = function(){
    var div = L.DomUtil.create('div','legend');

    div.innerHTML += "<b>Kawasan Hutan</b><br>";
    div.innerHTML += "<span style='background:#2e7d32'></span>HL<br>";
    div.innerHTML += "<span style='background:#66bb6a'></span>HP<br>";
    div.innerHTML += "<span style='background:#9ccc65'></span>HPT<br>";
    div.innerHTML += "<span style='background:#d4e157'></span>HPK<br><br>";

    div.innerHTML += "<b>PBPH</b><br>";
    div.innerHTML += "<span style='background:#ffa64d'></span>Area PBPH";

    return div;
};

legend.addTo(map);

</script>

</body>
</html>
